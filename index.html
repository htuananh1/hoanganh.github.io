<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Android Executors - Dynamic from JSON</title>
  <style>
    :root {
      --primary: #6a11cb;
      --secondary: #2575fc;
      --accent: #00f2fe;
      --dark: #121212;
      --light: #f8f9fa;
      --card-bg: rgba(30, 30, 45, 0.8);
      --online: #38ff80;
      --offline: #ff3b3b;
      --btn-main: #3fffc2;
      --btn-vng: #232323;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body, html {
      height: 100%;
      background: linear-gradient(135deg, #232526, #3a3a54, #181824 80%);
      color: var(--light);
      min-height: 100vh;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    .section-title {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.7rem;
      letter-spacing: 0.5px;
      text-shadow: 0 4px 24px #0008;
    }
    .section-title i {
      font-size: 1.3em;
      color: var(--accent);
    }
    .executor-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
      gap: 2rem;
      width: 100%;
    }
    .executor-card {
      background: linear-gradient(135deg, rgba(40,40,60,0.95), rgba(30,30,40,0.9));
      border-radius: 18px;
      padding: 2rem 1.5rem 1.5rem 1.5rem;
      box-shadow: 0 6px 32px #0005;
      position: relative;
      overflow: hidden;
      border: 1.5px solid rgba(0,0,0,0.13);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      min-height: 320px;
    }
    .executor-header {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: .7rem;
    }
    .executor-logo {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: #222;
      object-fit: contain;
      border: 1.5px solid #232323;
      box-shadow: 0 2px 12px #0003;
    }
    .executor-name {
      font-size: 1.25rem;
      font-weight: 600;
      color: #fff;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: .4em;
    }
    .executor-info {
      font-size: 1rem;
      color: #d2d2e0;
      margin-bottom: 0.4em;
      margin-left: 0.2em;
    }
    .executor-status {
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5em;
      margin-bottom: .6em;
      margin-left: 0.2em;
    }
    .status-dot {
      display: inline-block;
      width: 11px;
      height: 11px;
      border-radius: 50%;
      margin-right: .3em;
      vertical-align: middle;
    }
    .online { background: var(--online);}
    .offline { background: var(--offline);}
    .executor-actions {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 0.7em;
    }
    .main-row-actions {
      display: flex;
      gap: 0.7em;
      width: 100%;
    }
    .btn-download {
      flex: 1;
      background: var(--btn-main);
      color: #232323;
      font-weight: 700;
      border: none;
      border-radius: 10px;
      padding: 0.9em 0;
      font-size: 1.1em;
      cursor: pointer;
      transition: background .2s, color .2s, transform .18s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.7em;
      box-shadow: 0 2px 12px #00ffea22;
      text-decoration: none;
    }
    .btn-download:hover { background: #61ffd0; color: #161616; transform: translateY(-2px);}
    .btn-vng {
      flex: 1;
      background: var(--btn-vng);
      color: #eaeaea;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      padding: 0.9em 0;
      font-size: 1.1em;
      cursor: pointer;
      transition: background .2s, color .2s, transform .18s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.7em;
      box-shadow: 0 2px 12px #0004;
      text-decoration: none;
    }
    .btn-vng:hover { background: #292929; color: var(--accent); transform: translateY(-2px);}
    .edit-btn {
      position: absolute;
      top: 12px;
      right: 14px;
      background: rgba(0,0,0,0.09);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .18s;
      z-index: 4;
    }
    .edit-btn:hover {
      background: #232323;
    }
    .edit-btn i {
      color: var(--accent);
      font-size: 1.25em;
    }
    /* Popup sửa card */
    .popup-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn .2s;
    }
    @keyframes fadeIn { 0% {opacity: 0;} 100% {opacity: 1;} }
    .popup-card {
      background: #23263a;
      color: #f8f9fa;
      border-radius: 14px;
      padding: 2rem 1.5rem 1.5rem 1.5rem;
      min-width: 320px;
      max-width: 94vw;
      box-shadow: 0 8px 40px #0007;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 1.1em;
    }
    .popup-card label {
      font-weight: 500;
      margin-bottom: 0.3em;
      display: block;
    }
    .popup-card input, .popup-card select {
      width: 100%;
      padding: 0.6em 0.7em;
      border-radius: 7px;
      border: 1px solid #555a;
      background: #252740;
      color: #fafbfc;
      font-size: 1em;
      margin-bottom: 0.8em;
      margin-top: 0.13em;
    }
    .popup-actions {
      display: flex;
      gap: 1em;
      margin-top: 0.2em;
      justify-content: flex-end;
    }
    .popup-actions button {
      border: none;
      border-radius: 7px;
      font-size: 1.08em;
      padding: 0.5em 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: background .16s;
    }
    .btn-cancel { background: #333; color: #ccc;}
    .btn-save { background: var(--accent); color: #222;}
    .btn-save:hover { background: #57f6ff;}
    .btn-cancel:hover { background: #444;}
    @media (max-width: 900px) {
      .container { padding: 1rem 0.3rem; }
      .section-title { font-size: 1.3rem; }
    }
    @media (max-width: 600px) {
      .executor-card { padding: 1.1rem 0.7rem 1rem 0.7rem; }
      .executor-header { gap: 0.7rem;}
      .executor-logo { width: 34px; height: 34px;}
      .edit-btn { top: 6px; right: 7px; width: 30px; height: 30px;}
      .popup-card { min-width: 90vw; }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
</head>
<body>
  <div class="container">
    <div class="section-title">
      <i class="fa-brands fa-android"></i>
      Android Executors
    </div>
    <div class="executor-grid">

      <!-- Arceus X -->
      <div class="executor-card" data-keyword="arceus">
        <button class="edit-btn" title="Sửa thông tin"><i class="fas fa-pen"></i></button>
        <div class="executor-header">
          <img src="https://i.ibb.co/khKK7PC/arceus.png" alt="Arceus X" class="executor-logo"/>
          <span class="executor-name">Arceus X NEO</span>
        </div>
        <div class="executor-info">Version: <span class="info-version"></span></div>
        <div class="executor-info">VNG Version: <span class="info-vng"></span></div>
        <div class="executor-status">
          <span class="status-dot"></span>
          <span>Status: <span class="info-status"></span></span>
        </div>
        <div class="executor-actions">
          <div class="main-row-actions">
            <a href="#" class="btn-download info-download" target="_blank">
              <i class="fas fa-download"></i> Download
            </a>
          </div>
          <div class="main-row-actions">
            <a href="#" class="btn-vng info-vng-link" target="_blank">
              <i class="fas fa-download"></i> VNG
            </a>
          </div>
        </div>
      </div>

      <!-- Codex -->
      <div class="executor-card" data-keyword="codex">
        <button class="edit-btn" title="Sửa thông tin"><i class="fas fa-pen"></i></button>
        <div class="executor-header">
          <img src="https://files.catbox.moe/mmjwwd.png" alt="Codex" class="executor-logo"/>
          <span class="executor-name">Codex</span>
        </div>
        <div class="executor-info">Version: <span class="info-version"></span></div>
        <div class="executor-info">VNG Version: <span class="info-vng"></span></div>
        <div class="executor-status">
          <span class="status-dot"></span>
          <span>Status: <span class="info-status"></span></span>
        </div>
        <div class="executor-actions">
          <div class="main-row-actions">
            <a href="#" class="btn-download info-download" target="_blank">
              <i class="fas fa-download"></i> Download
            </a>
          </div>
          <div class="main-row-actions">
            <a href="#" class="btn-vng info-vng-link" target="_blank">
              <i class="fas fa-download"></i> VNG
            </a>
          </div>
        </div>
      </div>

      <!-- Delta -->
      <div class="executor-card" data-keyword="delta">
        <button class="edit-btn" title="Sửa thông tin"><i class="fas fa-pen"></i></button>
        <div class="executor-header">
          <img src="https://i.ibb.co/nbDv3Lx/delta.png" alt="Delta" class="executor-logo"/>
          <span class="executor-name">Delta</span>
        </div>
        <div class="executor-info">Version: <span class="info-version"></span></div>
        <div class="executor-info">VNG Version: <span class="info-vng"></span></div>
        <div class="executor-status">
          <span class="status-dot"></span>
          <span>Status: <span class="info-status"></span></span>
        </div>
        <div class="executor-actions">
          <div class="main-row-actions">
            <a href="#" class="btn-download info-download" target="_blank">
              <i class="fas fa-download"></i> Download
            </a>
          </div>
          <div class="main-row-actions">
            <a href="#" class="btn-vng info-vng-link" target="_blank">
              <i class="fas fa-download"></i> VNG
            </a>
          </div>
        </div>
      </div>

      <!-- Cryptic -->
      <div class="executor-card" data-keyword="cryptic">
        <button class="edit-btn" title="Sửa thông tin"><i class="fas fa-pen"></i></button>
        <div class="executor-header">
          <img src="https://getcryptic.net/assets/moonglow-HcoSKqMr.png" alt="Cryptic" class="executor-logo"/>
          <span class="executor-name">Cryptic</span>
        </div>
        <div class="executor-info">Version: <span class="info-version"></span></div>
        <div class="executor-info">VNG Version: <span class="info-vng"></span></div>
        <div class="executor-status">
          <span class="status-dot"></span>
          <span>Status: <span class="info-status"></span></span>
        </div>
        <div class="executor-actions">
          <div class="main-row-actions">
            <a href="#" class="btn-download info-download" target="_blank">
              <i class="fas fa-download"></i> Download
            </a>
          </div>
          <div class="main-row-actions">
            <a href="#" class="btn-vng info-vng-link" target="_blank">
              <i class="fas fa-download"></i> VNG
            </a>
          </div>
        </div>
      </div>

    </div>
  </div>
  <script>
  // ---- Cấu hình ----
  const DATA_URL = "https://raw.githubusercontent.com/htuananh1/hoanganh.github.io/refs/heads/main/data/executor-card.json";
  const GITHUB_REPO = "htuananh1/hoanganh.github.io";
  const GITHUB_PATH = "data/executor-card.json";

  // ---- Tiện ích ----
  function normalizeName(name) {
    return (name||"").toLowerCase().replace(/[^a-z0-9]/g, "");
  }
  async function fetchJSON(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Load JSON failed");
    return await res.json();
  }
  function showEditPopup(card, currentData, saveCallback) {
    const version = card.querySelector('.info-version').textContent.trim();
    const vngVersion = card.querySelector('.info-vng').textContent.trim();
    const status = card.querySelector('.info-status').textContent.trim();
    const download = card.querySelector('.info-download').href;
    const vng = card.querySelector('.info-vng-link').href;
    const popup = document.createElement('div');
    popup.className = "popup-bg";
    popup.innerHTML = `
      <div class="popup-card">
        <h3 style="font-size:1.2em;margin-bottom:1.1em;">Sửa thông tin Executor &amp; Gửi Github</h3>
        <label>Version:</label>
        <input type="text" class="edit-version" value="${version}" autocomplete="off"/>
        <label>VNG Version:</label>
        <input type="text" class="edit-vng-version" value="${vngVersion}" autocomplete="off"/>
        <label>Status:</label>
        <select class="edit-status">
          <option value="Online"${status==="Online"?" selected":""}>Online</option>
          <option value="Offline"${status==="Offline"?" selected":""}>Offline</option>
        </select>
        <label>Link Download:</label>
        <input type="text" class="edit-download" value="${download}" autocomplete="off"/>
        <label>Link VNG:</label>
        <input type="text" class="edit-vng" value="${vng}" autocomplete="off"/>
        <label>Token Github (base64):</label>
        <input type="password" class="edit-token" placeholder="Nhập token base64..." autocomplete="off"/>
        <div class="popup-actions">
          <button class="btn-cancel">Hủy</button>
          <button class="btn-save">Lưu &amp; Gửi Github</button>
        </div>
      </div>
    `;
    document.body.appendChild(popup);
    popup.querySelector('.btn-cancel').onclick = ()=> popup.remove();
    popup.querySelector('.btn-save').onclick = async ()=>{
      const newData = {
        name: card.querySelector('.executor-name').textContent.trim(),
        version: popup.querySelector('.edit-version').value.trim(),
        vngVersion: popup.querySelector('.edit-vng-version').value.trim(),
        status: popup.querySelector('.edit-status').value.trim(),
        download: popup.querySelector('.edit-download').value.trim(),
        vng: popup.querySelector('.edit-vng').value.trim()
      };
      const token = popup.querySelector('.edit-token').value.trim();
      if (!token) { alert("Bạn phải nhập token base64!"); return; }
      saveCallback(newData, token, popup);
    };
  }
  function decodeTokenBase64(tokenBase64) {
    try { return atob(tokenBase64.trim()); }
    catch(e) { return ""; }
  }
  async function pushToGitHub(tokenBase64, repo, path, content) {
    const token = decodeTokenBase64(tokenBase64);
    if (!token) {
      alert("Token base64 không hợp lệ!");
      return false;
    }
    const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;
    let sha = null;
    try {
      const res = await fetch(apiUrl, {
        headers: {
          Authorization: `token ${token}`,
          Accept: "application/vnd.github.v3+json",
        },
      });
      if (res.ok) {
        const json = await res.json();
        sha = json.sha;
      }
    } catch (e) {}
    const payload = {
      message: "Update executor card data",
      content: btoa(unescape(encodeURIComponent(content))),
      ...(sha && { sha }),
    };
    const response = await fetch(apiUrl, {
      method: "PUT",
      headers: {
        Authorization: `token ${token}`,
        Accept: "application/vnd.github.v3+json",
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    });
    if (response.ok) {
      alert("Đã gửi dữ liệu lên GitHub thành công!");
      return true;
    } else {
      alert("Lỗi gửi lên GitHub: " + await response.text());
      return false;
    }
  }

  // ---- Load dữ liệu và map vào card ----
  let executorList = [];
  function updateCardsFromList(list) {
    document.querySelectorAll('.executor-card').forEach(card=>{
      const keyword = card.getAttribute('data-keyword').toLowerCase();
      const ex = list.find(e => normalizeName(e.name).includes(keyword));
      if(!ex) {
        card.querySelector('.info-version').textContent = "";
        card.querySelector('.info-vng').textContent = "";
        card.querySelector('.info-status').textContent = "No data";
        card.querySelector('.info-download').href = "#";
        card.querySelector('.info-vng-link').href = "#";
        card.querySelector('.status-dot').className = "status-dot";
      } else {
        card.querySelector('.info-version').textContent = ex.version || "";
        card.querySelector('.info-vng').textContent = ex.vngVersion || "";
        card.querySelector('.info-status').textContent = ex.status || "";
        card.querySelector('.info-download').href = ex.download || "#";
        card.querySelector('.info-vng-link').href = ex.vng || "#";
        const dot = card.querySelector('.status-dot');
        dot.className = "status-dot " + (ex.status && ex.status.toLowerCase()==="online" ? "online" : "offline");
      }
    });
  }
  async function reloadExecutorsAndMap() {
    try {
      executorList = await fetchJSON(DATA_URL);
      if (!Array.isArray(executorList)) executorList = [executorList];
      updateCardsFromList(executorList);
    } catch {
      document.querySelectorAll('.executor-card').forEach(card=>{
        card.querySelector('.info-status').textContent = "Không tải được dữ liệu!";
      });
    }
  }
  reloadExecutorsAndMap();

  // ---- Sửa và lưu 1 card (chỉ update thông tin card đó trên github) ----
  document.querySelectorAll('.executor-card .edit-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const card = btn.closest('.executor-card');
      const keyword = card.getAttribute('data-keyword').toLowerCase();
      const currentEx = executorList.find(e => normalizeName(e.name).includes(keyword)) || {};
      showEditPopup(card, currentEx, async (newData, token, popup)=>{
        // 1. Cập nhật executorList
        let found = false;
        executorList = executorList.map(e=>{
          if (normalizeName(e.name).includes(keyword)) { found = true; return newData; }
          return e;
        });
        if (!found) executorList.push(newData); // Nếu chưa có, thêm mới
        // 2. Gửi lên github
        const ok = await pushToGitHub(token, GITHUB_REPO, GITHUB_PATH, JSON.stringify(executorList, null, 2));
        if (ok) {
          updateCardsFromList(executorList);
          popup.remove();
        }
      });
    });
  });
  </script>
</body>
</html>
